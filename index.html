<!DOCTYPE html>
<html>
<head>
  <title>WebSocket Client</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }
    #messages {
      height: 300px;
      border: 1px solid #ccc;
      overflow-y: auto;
      padding: 10px;
      margin-bottom: 10px;
    }
    .message { margin: 5px 0; }
  </style>
</head>
<body>
  <h1>WebSocket Client</h1>
  <div id="status">Connecting to server...</div>
  <div id="messages"></div>
  <div>
    <input type="text" id="messageInput" placeholder="Type your message">
    <button onclick="sendMessage()">Send</button>
  </div>

  <script>
  const status = document.getElementById('status');
  const messages = document.getElementById('messages');
  const messageInput = document.getElementById('messageInput');

  const username = prompt("Dein Name:");

  const ws = new WebSocket(
    location.protocol === 'https:'
      ? `wss://${location.host}`
      : 'ws://localhost:8080'
  );

  ws.binaryType = "blob";

  ws.onopen = () => {
    status.textContent = 'Connected to server';
    status.style.color = 'green';
  };

  ws.onmessage = async (event) => {
    let text = event.data instanceof Blob ? await event.data.text() : event.data;

    let msg;
    try {
      msg = JSON.parse(text);
    } catch {
      return;
    }

    const div = document.createElement('div');
    div.className = 'message';
    div.textContent = `[${new Date(msg.time).toLocaleTimeString()}] ${msg.user}: ${msg.text}`;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  };

  function sendMessage() {
    const text = messageInput.value.trim();
    if (!text) return;

    const payload = {
      user: username,
      text
    };

    ws.send(JSON.stringify(payload));
    messageInput.value = '';
  }

  messageInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') sendMessage();
  });
</script>

</body>
</html>
